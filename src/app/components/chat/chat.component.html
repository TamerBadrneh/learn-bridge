<div class="chat-wrapper">
  <h2>Chats</h2>
  <div class="chat-container">
    <!-- Sidebar -->
    <div class="chat-sidebar">
      <div class="search-container">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search..." />
        </div>
      </div>

      <div class="chat-list">
        <div
          class="chat-item"
          *ngFor="let chat of chats"
          (click)="selectChat(chat)"
        >
          <img
            src="https://staudt-gmbh.com/wp-content/uploads/2018/07/person-dummy.jpg"
            class="avatar"
            [alt]="chat.participantName || 'Chat'"
          />
          <div class="chat-info">
            <h5>{{ chat.participantName || "Unknown" }}</h5>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat main area -->
    <div class="chat-main">
      <ng-container *ngIf="selectedChatId !== null; else placeholder">
        <div class="chat-header">
          <div class="user">
            <img
              src="https://staudt-gmbh.com/wp-content/uploads/2018/07/person-dummy.jpg"
              class="avatar"
              alt="Chat User"
            />
            <h5>{{ selectedChatName }}</h5>
          </div>
          <div class="session-buttons">
            <button
              class="btn btn-light"
              [disabled]="loadingCancel"
              (click)="onCancelSession()"
            >
              {{ loadingCancel ? "Cancelling…" : "Cancel session" }}
            </button>
            <button
              class="btn btn-info text-white"
              [disabled]="loadingFinish"
              (click)="onFinishSession()"
            >
              {{ loadingFinish ? "Ending…" : "End Session" }}
            </button>
          </div>
        </div>

        <div class="chat-messages">
          <div
            class="message"
            *ngFor="let msg of messages"
            [ngClass]="msg.isSender ? 'right' : 'left'"
          >
            {{ msg.text }}
            <span class="msg-time">
              {{ msg.timestamp | date : "shortTime" }}
            </span>
            <div class="file-msg" *ngIf="msg.fileName">
              <i class="bi bi-file-earmark me-2"></i>
              {{ msg.fileName }}
            </div>
          </div>
        </div>

        <div class="chat-input">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Type your message and press enter..."
              [(ngModel)]="newMessage"
              (keydown.enter)="sendMessage()"
            />
          </div>
        </div>
      </ng-container>

      <ng-template #placeholder>
        <div
          class="d-flex h-100 justify-content-center align-items-center text-muted"
        >
          <h4>Select a chat to view messages</h4>
        </div>
      </ng-template>
    </div>
  </div>
</div>
